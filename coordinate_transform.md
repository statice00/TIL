## 좌표계

1. 지리좌표계(경도, 위도)
2. 투영좌표계(미터)



### 투영좌표계

투영좌표계란, 위 3차원 위경도 좌표를 2차원 평면 상으로 나타내기 위해 투영(projection)이라는 과정을 거치게 되는데 이 투영된 좌표를 투영좌표계라고 한다.

이 투영방법에 따라서도 여러가지 체계로 분류가 되는데, 크게 2가지로 분류한다.

- TM(Transverse meractor) : 횡단원통등각투영법
- UTM(Universal Transcerse Mercator)

두 투영방법은 같은 계산법을 거치지만 상수가 다를 뿐이다. **우리나라의 경우 TM좌표계를 기반으로 국가 기본도를 제작**하고 있으며, UTM은 군사지도나 단일원점을 사용하는 일부 부처에서 부분적으로 사용한다.

정리하자면

> 지리좌표계 : 위경도 좌표계, 3차원, WGS84
> 투영좌표계 : 미터 좌표계, 2차원, TM또는 UTM
>
> 

## EPSG코드

좌표계를 찾아보면서 위에서 언급한 TM, UTM, WGS, GRS와 같은 명칭 뿐아니라 EPSG로 표기한 명칭도 볼 수가 있다.
**EPSG는 이렇게 다양한 전세계 좌표계에 대한 고유한 명칭이다.**

지구를 표현할때,

- 어떤 타원체(WGS84, GRS80)?
- 어디를 중심으로(지리좌표계)?
- 어떻게 변환(투영법, TM, UTM)?

할거냐에 따라서 다양한 좌표계가 생겨나기 때문에, 이를 **EPSG라는 표준 고유 코드**를 만들어둔 것이다. 예를 들면, 아래와 같이 각기 다른 좌표계 생성 방식에 따라 구분이 필요하기 때문이다.

- 지리좌표계 : WGS84 => **EPSG4326**
- 투영좌표계 : GRS80타원체를 UTM-k로 투영한 좌표계 => **EPSG5179**

특히 위경도 좌표의 경우에 같은 좌표계지만 WGS84, GRS80, EPSG4326와 같이 표현되면서 혼동할 수가 있다. 따라서 고유 코드인 EPSG코드를 알아두면 헷갈리지 않고 좌표계를 활용할 수 있다.



# 대한민국 EPSG 코드

EPSG 코드는 전세계 좌표계 정의에 대한 고유한 명칭입니다. EPSG 코드에 대한 상세 정의는 prj4와 wkt라는 문자열로 되어 있으며, proj4와 EPSG의 wkt는 좌표계의 다양한 제원값을 정해진 문자열로 구성되어 있습니다. EPSG.io 라는 사이트를 통해 각 EPSG 코드에 대한 proj4와 wkt 문자열을 파악할 수 있습니다.

#### EPSG:4166, ESPG:4326

+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs 

WGS84 타원체의 경위도 좌표계입니다. 흔히 GPS 등의 기본 좌표계입니다.

#### EPSG:2097

+proj=tmerc +lat_0=38 +lon_0=127 +k=1 +x_0=200000 +y_0=500000 +ellps=bessel +units=m +no_defs +towgs84=-115.80,474.99,674.11,1.16,-2.31,-1.63,6.43

Bessel 1841 타원체의 한국 중부원점 TM 직각 좌표계입니다.

#### EPSG:5174

+proj=tmerc +lat_0=38 +lon_0=127.0028902777778 +k=1 +x_0=200000 +y_0=500000 +ellps=bessel +units=m +no_defs +towgs84=-115.80,474.99,674.11,1.16,-2.31,-1.63,6.43

일본의 기준점으로 끌어다 사용했다는 (개인적으로 사실이라고 해도 믿고 싶지 않지만?) 좌표계로, 일본에 지진이 발생하여 해당 기준점이 틀어진 만큼 보정된 좌표계입니다. 타원체는 Bessel 1841이며 TM 직각좌표계입니다. 폐기해야할 좌표계입니다. 개인적으로는 Bessel 타원체를 사용하는 모든 좌표계는 폐기하고 범세계적으로 GRS80 타원체로 통일해 사용해야 한다고 생각합니다.

#### ESPG:5178

+proj=tmerc +lat_0=38 +lon_0=127.5 +k=0.9996 +x_0=1000000 +y_0=2000000 +ellps=bessel +units=m +no_defs +towgs84=-115.80,474.99,674.11,1.16,-2.31,-1.63,6.43

Bessel 1841 타원체의 UTM-K 직각 좌표계입니다.

#### EPSG:5179 – 네이버 지도, 팜맵(https://agis.epis.or.kr/ASD/main/intro.do#)에서 사용함

+proj=tmerc +lat_0=38 +lon_0=127.5 +k=0.9996 +x_0=1000000 +y_0=2000000 +ellps=GRS80 +units=m +no_defs

GRS80 타원체의 UTM-K 직각 좌표계입니다. 네이버와 도로명주소 DB에서 사용하는 좌표계입니다.

#### ESPG:5181 – 카카오맵에서 사용함

+proj=tmerc +lat_0=38 +lon_0=127 +k=1 +x_0=200000 +y_0=500000 +ellps=GRS80 +units=m +no_defs

GRS80 타원체의 한국 중부원점이며 Y 축으로 500000미터만큼 이동시킨 좌표계입니다. 카카오 맵에서 사용하는 좌표계입니다.

#### EPSG:5186

+proj=tmerc +lat_0=38 +lon_0=127 +k=1 +x_0=200000 +y_0=600000 +ellps=GRS80 +units=m +no_defs

GRS80 타원체의 한국 중부원점이며 Y 축으로 600000미터만큼 이동시킨 좌표계입니다. 국가에서 제공하는 DXF나 NGI 형식의 공간데이터가 이 좌표계를 이용합니다. 중부원점이외에도 서부, 동부, 동해원점이 있으며 각각 EPSG:5185, EPSG:5187, EPSG:5188입니다.

#### EPSG:3857, EPSG:900913, EPSG:102113 – 구글맵, VWorld지도에서 사용함

+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@**null** +no_defs

구글맵, VWorld 지도에서 사용하는 좌표계입니다. TM 방식의 좌표계가 아니므로 거리 측정에 사용할 수 없는 좌표계입니다.





### 좌표계 변환

http://map.ngii.go.kr/ms/mesrInfo/coordinate.do

WGS84 경위도 EPSG:4326

GRS80 경위도 EPSG:4019

-> EPSG:5179

타원체: GRS80 -> UTM-K 좌표계








### 자주쓰는 좌표 정보

| EPSG code  |    좌표종류    |       데이터명        |            제공기관             |
| :--------: | :------------: | :-------------------: | :-----------------------------: |
|    4326    |   지리좌표계   |                       | 좌표가 도(degree)단위라면 모두! |
|    5174    | 투영좌표계(TM) |       용도지역        |        국가공간정보포털         |
|    5174    | 투영좌표계(TM) |    GIS건물통합정보    |        국가공간정보포털         |
|    5174    | 투영좌표계(TM) |       토지이용        |        국가공간정보포털         |
|    5174    | 투영좌표계(TM) |      연속지적도       |        국가공간정보포털         |
|    5174    | 투영좌표계(TM) |       용도지역        |        국가공간정보포털         |
|    5174    | 투영좌표계(TM) |    지방행정인허가     |           행정안전부            |
|    5179    | 투영좌표계(TM) |  도로명주소 전자지도  |           도로명주소            |
|    5179    | 투영좌표계(TM) |  도로명주소 배경지도  |           도로명주소            |
|    5179    | 투영좌표계(TM) |      네이버 지도      |             네이버              |
|    5181    | 투영좌표계(TM) |  카카오맵(다음지도)   |             카카오              |
|    5186    | 투영좌표계(TM) |    산림입지토양도     |             산림청              |
|    5186    | 투영좌표계(TM) | 초중고등학교 학군경계 |         한국교원대학교          |
| KOTI-KATEC |     KATEC      |      국가교통DB       |      한국교통연구원(KOTI)       |



```python
"""ref : https://www.osgeo.kr/17"""
from fiona.crs import from_string
## 위경도 좌표(기본)
epsg4326 = from_string("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs")

*#*# TM좌표(미터)
# 국가공간정보포털(용도지역, 건물통합정보, 토지이용, 연속지적도 등)
epsg5174 = from_string("+proj=tmerc +lat_0=38 +lon_0=127.0028902777778 +k=1 +x_0=200000 +y_0=500000 +ellps=bessel +units=m +no_defs +towgs84=-115.80,474.99,674.11,1.16,-2.31,-1.63,6.43")

# 도로명주소 데이터(전자지도, 배경지도)
epsg5179 = from_string("+proj=tmerc +lat_0=38 +lon_0=127.5 +k=0.9996 +x_0=1000000 +y_0=2000000 +ellps=GRS80 +units=m +no_defs")

# 카카오맵(다음지도)
epsg5181 = from_string("+proj=tmerc +lat_0=38 +lon_0=127 +k=1 +x_0=200000 +y_0=500000 +ellps=GRS80 +units=m +no_defs")
epsg5181_qgis = from_string("+proj=tmerc +lat_0=38 +lon_0=127 +k=1 +x_0=200000 +y_0=500000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs") # qgis 좌표, 보정좌표값 존재

# 산림청(산림입지토양도), 한국교원대학교(초중고 학교 위치 및 학군)
epsg5186 = from_string("+proj=tmerc +lat_0=38 +lon_0=127 +k=1 +x_0=200000 +y_0=600000 +ellps=GRS80 +units=m +no_defs")
```



### 좌표 변환 에러

위 방법처럼 정확하게 좌표를 정의하고, 동일하게 변환해주었음에도 딱 안맞는 경우가 생긴다(삽질의 시작..).

경험적으로 알게된 사실이지만 통일해야할 좌표계 중 EPSG5174,5186,KOTI-KATEC(그냥 안맞으면 한번 적용해보세요)가 존재하는 경우, 단순하게 좌표변환만 실시하게 되면 약 30m정도의 이격이 발생한다.

```python
epsg5181_qgis = from_string("+proj=tmerc +lat_0=38 +lon_0=127 +k=1 +x_0=200000 +y_0=500000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs")
```

이럴때 위 좌표계로 통일시켜주면 정확히 맞는다.

위는 QGIS에서 제공하는 EPSG5181좌표계로 정식 좌표 문자열과 달리 `+towgs84=0,0,0,0,0,0,0`가 추가되어 있다. 정확한 이유는 아직 잘 모르지만 해당 좌표계로 통일시켜주면 맞는다.





